<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="description"
          content="Vali is a responsive and free admin theme built with Bootstrap 4, SASS and PUG.js. It's fully customizable and modular.">
    <!-- Twitter meta-->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:site" content="@pratikborsadiya">
    <meta property="twitter:creator" content="@pratikborsadiya">
    <title>User Profile - Vali Admin</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Main CSS-->
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link rel="stylesheet" type="text/css" href="js/bootstrap.min.js"/>
    <link rel="stylesheet" href="../plugins/elementui/index.css">
    <link rel="stylesheet" href="../plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="css/normalize.css"/>
    <link rel="stylesheet" type="text/css" href="css/htmleaf-demo.css">
    <link rel="stylesheet" href="css/style.css" type="text/css"/>
    <link rel="stylesheet" type="text/css" href="css/tck.css"/>
    <link rel="stylesheet" type="text/css" href="css/popping.css">
    <link rel="stylesheet" href="dist/jdialog.min.css">
    <link rel="stylesheet" href="site/rainbow-customer.min.css">
    <link rel="stylesheet" href="site/style.css">
</head>
<body class="app sidebar-mini">

<!-- 新增标签弹层 -->
<div id="app">

    <!--模态窗口用来修改头像-->
    <div class="jDialog" id="dialog-4">
        <div class="content">
            <h3>修改头像</h3>
            <div>
                <div id="editHeader" class="htmleaf-container"
                     style="position: relative;display: block;">
                    <div class="container" style="left: -18px;">
                        <div class="imageBox">
                            <div class="thumbBox"></div>
                            <div class="spinner">Loading...</div>
                        </div>
                        <div class="action">
                            <div class="new-contentarea tc">
                                <a href="javascript:void(0)" class="upload-img">
                                    <label for="upload-file">上传图像</label>
                                </a>
                                <input type="file" class="" name="upload-file" id="upload-file"
                                       @click="upload"/>
                            </div>
                            <input type="button" id="btnCrop" class="Btnsty_peyton" value="裁切"
                                   @click="crop">
                            <input type="button" id="btnZoomIn" class="Btnsty_peyton" value="+"
                                   @click="zoomIn">
                            <input type="button" id="btnZoomOut" class="Btnsty_peyton" value="-"
                                   @click="zoomOut">
                        </div>
                        <button class="button button_close" data-dismiss="JDialog" id="test"
                        >关闭
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>


    <div class="app-sidebar__overlay" data-toggle="sidebar"></div>
    <main class="app-content">
        <div class="row user" style="width: 100%;">
            <div class="col-md-12">
                <div class="profile">
                    <div class="info">
                        <a href="javascript:void(0)" data-toggle="JDialog" data-target="dialog-4">
                            <img id="headImg" class="user-img" src="../img/user2-160x160.jpg">
                        </a>
                        <h4 id="headName">张三</h4>
                        <p id="headRole">情感按摩师</p>
                    </div>
                    <div><img src="./images/nature.jpg" width="1300px" height="300px"/></div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="tile p-0">
                    <ul class="nav flex-column nav-tabs user-tabs">
                        <li class="nav-item"><a class="nav-link" href="#user-settings" data-toggle="tab" style="color: black;">个人设置</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-md-9">
                <div class="tab-content">
                    <div class="tab-pane active" id="user-settings">
                        <div class="tile user-settings">
                            <h4 class="line-head">个人信息</h4>
                            <form id="form" action="/user/updateUser.do" type="post">
                                <input type="hidden" id="hidden" name="id">
                                <div class="row">
                                    <div class="col-md-8 mb-4">
                                        <label>登录账号</label>
                                        <input id="username" name="username" class="form-control" type="text" disabled>
                                    </div>
                                    <div class="clearfix"></div>
                                    <div class="col-md-8 mb-4">
                                        <label>昵称</label>
                                        <input id="name" name="name" class="form-control" type="text">
                                    </div>
                                    <div class="clearfix"></div>
                                    <div class="form-check col-md-8 mb-4">
                                        <label class="form-check-label">
                                            <label>性别</label>
                                            <br>
                                            <input id="male" type="radio" name="gender" value="男"> 小哥哥
                                             &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                            <input id="female" type="radio" name="gender" value="女"> 小姐姐
                                        </label>
                                    </div>
                                    <div class="clearfix"></div>
                                    <div class="col-md-8 mb-4">
                                        <label>登录密码</label>
                                        <input class="form-control" type="text" name="password">
                                    </div>
                                    <div class="clearfix"></div>
                                    <div class="col-md-8 mb-4">
                                        <label>手机号码</label>
                                        <input id="tel" class="form-control" type="text" name="telephone">
                                    </div>
                                </div>
                                <div class="row mb-10">
                                    <div class="col-md-12">
                                        <button id="submit_btn" class="btn btn-primary" type="button"><i
                                                class="fa fa-fw fa-lg fa-check-circle"></i> Save
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>
<!-- Essential javascripts for application to work-->
<script src="js/jquery-1.11.0.min.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/main.js"></script>
<!-- The javascript plugin to display page loading on top-->
<script src="js/plugins/pace.min.js"></script>
<script src="../js/axios-0.18.0.js"></script>
<script src="../js/vue.js"></script>
<script src="../plugins/elementui/index.js"></script>
<!--<script>window.jQuery || document.write('<script src="js/jquery-1.11.0.min.js"><\/script>')</script>-->
<script type="text/javascript" src="js/cropbox.js"></script>
<script src="site/rainbow-custom.min.js"></script>
<script src="dist/jdialog.min.js"></script>
<script type="text/javascript">
    $("#dialog-4").jDialog({
        skinClassName: 'demo',
        animationType: 'flip',
        allowOverlay: false
    });
</script>
<script type="text/javascript">
    $(window).load(function () {
        //发送ajax请求获取当前登录用户的所有信息
        $.get('/user/findLoginUser.do', (res) => {
            var options =
                {
                    thumbBox: '.thumbBox',
                    spinner: '.spinner',
                    imgSrc: '../img/user2-160x160.jpg'
                };
            //如果当前用户设置了头像, 那么改变裁切框中显示的头像
            if (res.data.headimg != null) {
                $("#headImg").attr("src", res.data.headimg);
                options.imgSrc = res.data.headimg;
            }

            var cropper = $('.imageBox').cropbox(options);
            //上传头像
            $('#upload-file').on('change', function () {
                var reader = new FileReader();
                reader.onload = function (e) {
                    options.imgSrc = e.target.result;
                    cropper = $('.imageBox').cropbox(options);
                };
                reader.readAsDataURL(this.files[0]);
            });
            //裁切头像并保存到云端
            $('#btnCrop').on('click', function () {
                var img = cropper.getDataURL();
                //发送ajax将img转成图片存储到云端并修改数据库的图片地址
                $.post('/user/updateHeadImg.do', {"imgFile": img}, (res) => {
                });
                //修改头像成功
                if (window != top) {
                    top.location.reload();
                }
            });
            //缩小
            $('#btnZoomIn').on('click', function () {
                cropper.zoomIn();
            });
            //放大
            $('#btnZoomOut').on('click', function () {
                cropper.zoomOut();
            });
            //给页面中的表单进行赋值, 数据回显
            $("#username").val(res.data.username);
            $("#name").val(res.data.name);
            if (res.data.gender == '男') {
                $("#male").attr("checked", "checked");
            } else {
                $("#female").attr("checked", "checked");
            }
            $("#tel").val(res.data.telephone);
            $("#headName").html(res.data.name);
            var roles = res.data.roles;
            var content = '';
            for (var i = 0; i < roles.length; i++) {
                content += roles[i].name + "<br>";
            }
            $("#headRole").html(content);
            $("#hidden").val(res.data.id);
        });
        $("#submit_btn").click(updateUser);
    });
    function updateUser() {
        axios.post('/user/updateUser.do', $('#form').serialize()).then((res) => {
            top.location.reload();
        })
    }
</script>

</body>
</html>